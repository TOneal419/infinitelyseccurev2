{% load static %}

{% block content %}

<!-- <div id='root'></div> -->
<html style="margin-left: 20px; margin-right: 20px;">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/index.css" %}" />
  </head>
<div class="jumbotron">
  <nav class="navbar navbar-default navbar-static-top navbar-inverse">
    <div class="container">
      <ul class="nav navbar-nav">
        <li class="active">
          <a href="/"><span class="glyphicon glyphicon-home"></span> Home</a>
        </li>
        <li>
          <a href="/learn">Learn</a>
        </li>
        <li>
          <a href="/virustotal">VirusTotal</a>
        </li>
        <li>
          <a href="/pwn">havibeenpwned</a>
        </li>
        <li>
          <a href="/test">Test Yourself</a>
        </li>
      </ul>
    </div>
  </nav>

  <audio>
    <source src="{% static 'mp3/VT/welcome.mp3' %}" type ='audio/mpeg'>
  </audio>
<body>
  <h2>What does being "malicious" mean?</h2>
  <p>Malicious describes something that is intending to cause harm.</p>
      <audio controls>
        <source src="{% static 'mp3/VT/malicious_means.mp3' %}" type ='audio/mpeg'>
      </audio>
  <h2>What is VirusTotal?</h2>
  <p>VirusTotal is a trusted site within the cybersecurity community that is able to check a URL and tell you if it is malicious.</p>
  <p>On the <a href="https://www.virustotal.com/gui/home/url">VirusTotal website</a>, you can also check files, IP addresses, domain names and file hashes to see if they are malicious.</p>
      <audio controls  >
        <source src="{% static 'mp3/VT/VT_is.mp3' %}" type ='audio/mpeg'>
      </audio>
  <h2>What to do if you have discovered a malicious URL?</h2>
  <p>The obvious course of action is to NOT go to the link.  However if the majority is showing that the link is harmless, it is unlikely to cause harm.  Also if threats are not there, it is also unlikely to be malicious.</p>
      <audio controls  >
        <source src="{% static 'mp3/VT/What_to_do.mp3' %}" type ='audio/mpeg'>
      </audio>
  <h2>How to use:</h2>
  <p>Example Input that shows has some maliciousness: www.google.com</p>
  <p>Example Input that shows has no maliciousness: www.pinterest.com</p>
      <audio controls  >
        <source src="{% static 'mp3/VT/How_to_Use.mp3' %}" type ='audio/mpeg'>
      </audio>
  <p>Input the URL that you want to check in the text box here:</p>
  <form id='form_vt' action='api/vt' method="post">
    <input id="vtinput" type="text" name="Url">
    <input id='vtinputid' type='hidden' name='Id'>
    <a href="#" onclick='submitForm()'>Submit</a>

  </form>
  <script>
    /*
    function submitAudio() {
      var http = new XMLHttpRequest();
      http.open("POST", "api/vt", true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      var params = "filename=" + "HIBP\\results" + "&scripts=" + String(document.getElementById("vtoutput").value);
      http.send(params);
      http.onload function() {
        var audio = new Audio("VT/results.mp3");
        audio.play();
      }
    }
    */
    function submitForm() {
      //let form = document.getElementById("form_vt");
      //document.getElementById("vtoutput").innerHTML = form.submit().innerHTML;
      var http = new XMLHttpRequest();
      http.open("POST", "api/vt", true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      var params = "Url=" + document.getElementById('vtinput').value ;
      http.send(params);
      http.onload = function() {
        const myObj = JSON.parse(http.responseText)
        var printable = "Time Submitted: " + myObj.submitted + "<br>";
        var harmless = ":        ";
        var malicious = "";
        var suspicious = "";
        var undetected = "";
        var timeout = "";
        for (var key in myObj.Data) {
          
          if (myObj.Data[key].category == "harmless"){
            harmless +=  String(key) + ", ";
          } 
          if (myObj.Data[key].category == "malicious") {
            malicious += ": " + String(key) + ",    Reason: " + String(myObj.Data[key].result) + "<br>"
          }// else 
          if (myObj.Data[key].category == "suspicious" ) {
            suspicious += String(key) + ", "
          } //else if (myObj.Data[key].category == "undetected") {
            //undetected +=  "----" + String (key) + "<br>"
        //  } else {
          //  timeout += "----" String(key) + "<br>"
         // }
        }
        var printable1 = printable + "<br>";
        printable1 +=  String(myObj.Stats.harmless) + " Search Engines that Found this URL harmless <br>" + harmless + "<br><br>";
        printable1 +=  String(myObj.Stats.malicious) + " Search Engines Found this URL malicious <br> " + malicious + "<br><br>";
        printable1 += String(myObj.Stats.suspicious) + " Search Engines Fount this URl suspicious <br> " + suspicious + "<br><br>";
        printable1 += String(myObj.Stats.undetected) + " Search Engines were Unable to Detect the URL <br> " + undetected + "<br><br>";
        printable1 += String(myObj.Stats.timeout) + " Search Engines Timed out " + timeout + "<br><br>";
        //JSON.stringify(http.responseText);
        document.getElementById('vtoutput').innerHTML = printable1;
      }
    }
  </script>
  <h2>Results:</h2>
  <p id="vtoutput"></p>
  {% comment %} <a href="#" onclick='submitAudio()'>Submit</a>
  <audio controls  >
    <source src="{% static 'mp3/Vt/results.mp3' %}" type ='audio/mpeg'>
  </audio> {% endcomment %}
</body>
</div>
{% endblock %}
</html>
