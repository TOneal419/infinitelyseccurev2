<html>
  {% load static %}

  {% block content %}
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/index2.css" %}" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!-- Fontawesome -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <!-- JS scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  </head>

  <!-- Audio Files -->
  <audio id='mm'>
    <source src="{% static 'mp3/VT/malicious_means.mp3' %}" type ='audio/mpeg'>
  </audio>
  <audio id='VTis'  >
    <source src="{% static 'mp3/VT/VT_is.mp3' %}" type ='audio/mpeg'>
  </audio>
  <audio id='WTD'>
    <source src="{% static 'mp3/VT/What_to_do.mp3' %}" type ='audio/mpeg'>
  </audio>
  <audio id='HU'>
    <source src="{% static 'mp3/VT/How_to_Use.mp3' %}" type ='audio/mpeg'>
  </audio>
  <audio id='res'>
    <source src="{% static 'mp3/VT/results.mp3' %}" type ='audio/mpeg'>
  </audio> 

<body>

  <!-- Nav Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #b13d59; ">
    <div class="container me-auto mb-2 mb-lg-0" id="navbar">
      <a class="navbar-brand" href="/" style="font-family:'Great Vibes', cursive">
        <!-- <img src="seccure imgae" alt="seccure image" width="60" height="60" class="d-inline-block" id="navImg"> -->
        SecCure
      </a>
      <div class="d-flex" >
        <ul class="navbar-nav ">
          <li class="nav-item" id="navItem">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item" id="navItem">
            <a class="nav-link" href="/learn">Learn</a>
          </li>
          <li class="nav-item" id="navItem">
            <a class="nav-link active" aria-current="page" href="/virustotal">VirusTotal</a>
          </li>
          <li class="nav-item" id="navItem">
            <a class="nav-link" href="/pwn">haveibeenpwned</a>
          </li>
          <li class="nav-item" id="navItem">
            <a class="nav-link" href="/test">Test Yourself</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <section></section>

  <section class="container" id="alternate-box">
    <div class="container mb-3">
      <h2>
        What does being "malicious" mean?
        <a  onclick="playAudio('mm')"><img src="{% static 'mp3/playbutton.png' %}" width=25 height=25></a>
        <a  onclick="pauseAudio('mm')"><img src="{% static 'mp3/pausebutton.png' %}" width=25 height=25></a>
      </h2>
      <p>Malicious describes something that is intending to cause harm.</p>
    </div>

    <div class="container mb-3">
      <h2>
        What is VirusTotal?
        <a  onclick="playAudio('VTis')"><img src="{% static 'mp3/playbutton.png' %}" width=25 height=25></a>
        <a  onclick="pauseAudio('VTis')"><img src="{% static 'mp3/pausebutton.png' %}" width=25 height=25></a>
      </h2>
      <p>VirusTotal is a trusted site within the cybersecurity community that is able to check a URL and tell you if it is malicious.</p>
      <p>On the <a href="https://www.virustotal.com/gui/home/url">VirusTotal website</a>, you can also check files, IP addresses, domain names and file hashes to see if they are malicious.</p>
    </div>

    <div class="container">
      <h2>
        What to do if you have discovered a malicious URL?
        <a  onclick="playAudio('WTD')"><img src="{% static 'mp3/playbutton.png' %}" width=25 height=25></a>
        <a  onclick="pauseAudio('WTD')"><img src="{% static 'mp3/pausebutton.png' %}" width=25 height=25></a>
      </h2>
      <p>The obvious course of action is to NOT go to the link.  However if the majority is showing that the link is harmless, it is unlikely to cause harm.  Also if threats are not there, it is also unlikely to be malicious.</p>
    </div>  
  </section>

  <section></section>

  <section id='alternate-box' class="container" style="text-align: center;">
    <h2>How to use:</h2>
    <p>Example Input that shows has some maliciousness: www.google.com</p>
    <p>Example Input that shows has no maliciousness: www.pinterest.com</p> 
    <p>Input the URL that you want to check in the text box below</p>
    <form id='form_vt' method="post">
      {% csrf_token %}
      <input id="vtinput" type="text" name="Url" size="50" style="text-align: center;">
      <input id='vtinputid' type='hidden' name='Id'><br> <br>
      <input type="button" class="btn btn-danger" name="submit" onclick='submitForm()' value="Submit">
    </form>
    <a onclick="playAudio('HU')"><img src="{% static 'mp3/playbutton.png' %}" width=25 height=25></a>
    <a onclick="pauseAudio('HU')"><img src="{% static 'mp3/pausebutton.png' %}" width=25 height=25></a>
  </section>

  <section></section>

  <section id="alternate-box" class="container" style="text-align: center;">
    <h2>Results:</h2><br>
    <p id="vtoutput" style="text-align: left;"></p>
    <a  onclick="playAudio('res')"><img src="{% static 'mp3/playbutton.png' %}" width=25 height=25></a>
    <a  onclick="pauseAudio('res')"><img src="{% static 'mp3/pausebutton.png' %}" width=25 height=25></a>
  </section>

  <section></section>

  <!-- Javascript -->

  <script>
  
    function submitForm() {
      //let form = document.getElementById("form_vt");
      //document.getElementById("vtoutput").innerHTML = form.submit().innerHTML;
      var http = new XMLHttpRequest();
      http.open("POST", "api/vt", true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      var params = "Url=" + document.getElementById('vtinput').value ;
      http.send(params);
      http.onload = function() {
        const myObj = JSON.parse(http.responseText)
        var printable = "Time Submitted: " + myObj.submitted + "<br>";
        var harmless = ":        ";
        var malicious = "";
        var suspicious = "";
        var undetected = "";
        var timeout = "";
        for (var key in myObj.Data) {
          
          if (myObj.Data[key].category == "harmless"){
            harmless +=  String(key) + ", ";
          } 
          if (myObj.Data[key].category == "malicious") {
            malicious += ": " + String(key) + ",    Reason: " + String(myObj.Data[key].result) + "<br>"
          }// else 
          if (myObj.Data[key].category == "suspicious" ) {
            suspicious += String(key) + ", "
          } //else if (myObj.Data[key].category == "undetected") {
            //undetected +=  "----" + String (key) + "<br>"
        //  } else {
          //  timeout += "----" String(key) + "<br>"
         // }
        }
        var printable1 = printable + "<br>";
        printable1 +=  String(myObj.Stats.harmless) + " Search Engines that Found this URL harmless <br>" + harmless + "<br><br>";
        printable1 +=  String(myObj.Stats.malicious) + " Search Engines Found this URL malicious <br> " + malicious + "<br><br>";
        printable1 += String(myObj.Stats.suspicious) + " Search Engines Fount this URl suspicious <br> " + suspicious + "<br><br>";
        printable1 += String(myObj.Stats.undetected) + " Search Engines were Unable to Detect the URL <br> " + undetected + "<br><br>";
        printable1 += String(myObj.Stats.timeout) + " Search Engines Timed out " + timeout + "<br><br>";
        //JSON.stringify(http.responseText);
        document.getElementById('vtoutput').innerHTML = printable1;
        var https = new XMLHttpRequest();
          https.open("POST", "api/tts", true);
          https.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          var hold = document.getElementById('vtoutput');
          if (String(hold.innerHTML) == "undefined") {
            hold = "No Content";
          } 
          var params = "filename=VT/results" +"&scripts=" + String(hold.textContent || hold.innerText) ;
          https.send(params);
      }
    }
  </script>
  
</body>
<!--Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
{% endblock %}
</html>
